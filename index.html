import React, { useState } from "react";
import "./App.css";

const mapScoreToDial = (score, buckets) => {
  const normalized = score / 100;
  const bucket = buckets.find(b => normalized >= b.low && normalized < b.high) || buckets[buckets.length - 1];

  let dialMin, dialMax;
  switch (bucket.type) {
    case "dangerous":
      dialMin = 0;
      dialMax = 33;
      break;
    case "average":
      dialMin = 34;
      dialMax = 66;
      break;
    case "good":
      dialMin = 67;
      dialMax = 100;
      break;
    default:
      return 0;
  }

  const bucketRange = bucket.high - bucket.low;
  const scoreRelative = (normalized - bucket.low) / bucketRange;
  return Math.round(dialMin + scoreRelative * (dialMax - dialMin));
};

function App() {
  const [score, setScore] = useState(50);
  const [buckets, setBuckets] = useState([
    { low: 0.0, high: 0.846509, type: "dangerous" },
    { low: 0.846509, high: 0.945721, type: "average" },
    { low: 0.945721, high: 1.0, type: "good" },
  ]);

  const dialScore = mapScoreToDial(score, buckets);

  return (
    <div className="container">
      <h1>Insight Bucket Visualizer</h1>
      <div>
        <label>Score: {score}</label>
        <input
          type="range"
          min="0"
          max="100"
          value={score}
          onChange={(e) => setScore(parseInt(e.target.value))}
        />
      </div>

      <div>
        <h2>Bucket Thresholds</h2>
        {buckets.map((bucket, i) => (
          <div key={i} className="bucket-row">
            <input
              type="number"
              step="0.0001"
              value={bucket.low}
              onChange={(e) => {
                const newBuckets = [...buckets];
                newBuckets[i].low = parseFloat(e.target.value);
                setBuckets(newBuckets);
              }}
            />
            <input
              type="number"
              step="0.0001"
              value={bucket.high}
              onChange={(e) => {
                const newBuckets = [...buckets];
                newBuckets[i].high = parseFloat(e.target.value);
                setBuckets(newBuckets);
              }}
            />
            <select
              value={bucket.type}
              onChange={(e) => {
                const newBuckets = [...buckets];
                newBuckets[i].type = e.target.value;
                setBuckets(newBuckets);
              }}
            >
              <option value="dangerous">Dangerous</option>
              <option value="average">Average</option>
              <option value="good">Good</option>
            </select>
          </div>
        ))}
      </div>

      <div className="dial-bar">
        <div className="dangerous" />
        <div className="average" />
        <div className="good" />
        <div
          className="dial-indicator"
          style={{ left: `${(dialScore / 100) * 100}%` }}
        />
      </div>
      <p className="dial-score">Mapped Dial Score: {dialScore}</p>
    </div>
  );
}

export default App;
